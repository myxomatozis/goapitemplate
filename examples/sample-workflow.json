{
  "id": "user-onboarding",
  "name": "User Onboarding Workflow",
  "description": "Complete user onboarding process with notifications and setup",
  "start_step": "validate_user",
  "variables": {
    "user_id": 0,
    "email": "",
    "retry_count": 0
  },
  "steps": {
    "validate_user": {
      "name": "Validate User Data",
      "type": "condition",
      "description": "Validate that user data is complete",
      "config": {
        "max_retries": 2,
        "timeout_ms": 5000,
        "retry_delay_ms": 1000,
        "continue_on_error": false,
        "condition": "input.email != '' && input.user_id > 0",
        "parameters": {
          "condition": "input.email != '' && input.user_id > 0"
        }
      },
      "on_success": "send_welcome_email",
      "on_error": "validation_failed"
    },
    "send_welcome_email": {
      "name": "Send Welcome Email",
      "type": "http_request",
      "description": "Send welcome email to the new user",
      "config": {
        "max_retries": 3,
        "timeout_ms": 10000,
        "retry_delay_ms": 2000,
        "continue_on_error": true,
        "parameters": {
          "url": "https://api.emailservice.com/send",
          "method": "POST",
          "headers": {
            "Content-Type": "application/json",
            "Authorization": "Bearer ${EMAIL_API_TOKEN}"
          },
          "body": {
            "to": "${input.email}",
            "template": "welcome",
            "variables": {
              "user_id": "${input.user_id}",
              "name": "${input.name}"
            }
          }
        }
      },
      "on_success": "create_user_profile",
      "on_error": "email_failed",
      "on_timeout": "email_timeout"
    },
    "create_user_profile": {
      "name": "Create User Profile",
      "type": "database_query",
      "description": "Create user profile in database",
      "config": {
        "max_retries": 2,
        "timeout_ms": 5000,
        "retry_delay_ms": 1000,
        "continue_on_error": false,
        "parameters": {
          "query": "INSERT INTO user_profiles (user_id, status, created_at) VALUES (?, ?, ?)",
          "params": ["${input.user_id}", "active", "${now()}"]
        }
      },
      "on_success": "setup_notification_preferences",
      "on_error": "profile_creation_failed"
    },
    "setup_notification_preferences": {
      "name": "Setup Notification Preferences",
      "type": "event_publish",
      "description": "Publish event to setup default notifications",
      "config": {
        "max_retries": 1,
        "timeout_ms": 3000,
        "continue_on_error": true,
        "parameters": {
          "event_type": "user.notifications.setup",
          "data": {
            "user_id": "${input.user_id}",
            "preferences": {
              "email": true,
              "push": false,
              "sms": false
            }
          }
        }
      },
      "on_success": "wait_for_setup",
      "on_error": "onboarding_complete"
    },
    "wait_for_setup": {
      "name": "Wait for Setup Completion",
      "type": "delay",
      "description": "Wait 5 seconds for setup to complete",
      "config": {
        "timeout_ms": 6000,
        "parameters": {
          "delay_ms": 5000
        }
      },
      "on_success": "onboarding_complete",
      "on_error": "onboarding_complete",
      "on_timeout": "onboarding_complete"
    },
    "onboarding_complete": {
      "name": "Onboarding Complete",
      "type": "event_publish",
      "description": "Publish completion event",
      "config": {
        "max_retries": 1,
        "timeout_ms": 3000,
        "parameters": {
          "event_type": "user.onboarding.completed",
          "data": {
            "user_id": "${input.user_id}",
            "completed_at": "${now()}",
            "status": "success"
          }
        }
      }
    },
    "validation_failed": {
      "name": "Validation Failed",
      "type": "event_publish",
      "description": "Publish validation failure event",
      "config": {
        "parameters": {
          "event_type": "user.onboarding.failed",
          "data": {
            "user_id": "${input.user_id}",
            "reason": "validation_failed",
            "step": "validate_user"
          }
        }
      }
    },
    "email_failed": {
      "name": "Email Failed",
      "type": "event_publish",
      "description": "Publish email failure event but continue onboarding",
      "config": {
        "parameters": {
          "event_type": "user.email.failed",
          "data": {
            "user_id": "${input.user_id}",
            "reason": "email_delivery_failed"
          }
        }
      },
      "on_success": "create_user_profile"
    },
    "email_timeout": {
      "name": "Email Timeout",
      "type": "event_publish",
      "description": "Email service timed out",
      "config": {
        "parameters": {
          "event_type": "user.email.timeout",
          "data": {
            "user_id": "${input.user_id}",
            "reason": "email_timeout"
          }
        }
      },
      "on_success": "create_user_profile"
    },
    "profile_creation_failed": {
      "name": "Profile Creation Failed",
      "type": "event_publish",
      "description": "Critical failure - stop onboarding",
      "config": {
        "parameters": {
          "event_type": "user.onboarding.failed",
          "data": {
            "user_id": "${input.user_id}",
            "reason": "profile_creation_failed",
            "step": "create_user_profile"
          }
        }
      }
    }
  }
}